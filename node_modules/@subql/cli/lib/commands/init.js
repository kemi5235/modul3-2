"use strict";
// Copyright 2020-2021 OnFinality Limited authors & contributors
// SPDX-License-Identifier: Apache-2.0
Object.defineProperty(exports, "__esModule", { value: true });
const tslib_1 = require("tslib");
const fs_1 = tslib_1.__importDefault(require("fs"));
const path_1 = tslib_1.__importDefault(require("path"));
const command_1 = require("@oclif/command");
const cli_ux_1 = tslib_1.__importDefault(require("cli-ux"));
const init_controller_1 = require("../controller/init-controller");
class Init extends command_1.Command {
    async run() {
        const { args, flags } = this.parse(Init);
        const project = {};
        project.name = args.projectName
            ? args.projectName
            : await cli_ux_1.default.prompt('Project name', { default: 'subql-starter', required: true });
        if (fs_1.default.existsSync(path_1.default.join(process.cwd(), `${project.name}`))) {
            throw new Error(`Directory ${project.name} exists, try another project name`);
        }
        project.repository = await cli_ux_1.default.prompt('Git repository', { required: false });
        project.endpoint = await cli_ux_1.default.prompt('RPC endpoint', {
            default: 'wss://polkadot.api.onfinality.io/public-ws',
            required: true,
        });
        project.author = await cli_ux_1.default.prompt('Authors', { required: true });
        project.description = await cli_ux_1.default.prompt('Description', { required: false });
        project.version = await cli_ux_1.default.prompt('Version:', { default: '1.0.0', required: true });
        project.license = await cli_ux_1.default.prompt('License:', { default: 'Apache-2.0', required: true });
        if (flags.starter && project.name) {
            cli_ux_1.default.action.start('Init the starter package');
            try {
                await init_controller_1.createProject(process.cwd(), project);
                cli_ux_1.default.action.stop(`${project.name} is ready`);
            }
            catch (e) {
                /* handle all errors here */
                console.error(e.message);
                process.exit(1);
            }
        }
    }
}
exports.default = Init;
Init.description = 'Init a scaffold subquery project';
Init.flags = {
    force: command_1.flags.boolean({ char: 'f' }),
    starter: command_1.flags.boolean({
        default: true,
    }),
};
Init.args = [
    {
        name: 'projectName',
        description: 'Give the starter project name',
    },
];
//# sourceMappingURL=init.js.map